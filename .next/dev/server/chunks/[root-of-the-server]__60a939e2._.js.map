{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/game/affiliate-growth-hub/src/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from 'mongodb';\n\nconst uri = process.env.MONGODB_URI;\nconst options = {};\n\nif (!uri) {\n  throw new Error('Please add your Mongo URI to .env.local');\n}\n\nlet client: MongoClient;\nlet clientPromise: Promise<MongoClient>;\n\nif (process.env.NODE_ENV === 'development') {\n  // In development mode, use a global variable so that the value\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\n  if (!global._mongoClientPromise) {\n    client = new MongoClient(uri, options);\n    global._mongoClientPromise = client.connect();\n  }\n  clientPromise = global._mongoClientPromise;\n} else {\n  // In production mode, it's best to not use a global variable.\n  client = new MongoClient(uri, options);\n  clientPromise = client.connect();\n}\n\n// Export a module-scoped MongoClient promise. By doing this in a\n// separate module, the client can be shared across functions.\nexport default clientPromise;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI,CAAC,KAAK;IACR,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,yDAAO,mBAAmB,EAAE;QAC/B,SAAS,IAAI,oKAAW,CAAC,KAAK;QAC9B,yDAAO,mBAAmB,GAAG,OAAO,OAAO;IAC7C;IACA,gBAAgB,yDAAO,mBAAmB;AAC5C;;uCAQe"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///D:/game/affiliate-growth-hub/src/app/api/affiliator/links/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport clientPromise from '@/lib/mongodb';\nimport { AffiliateLink, Product } from '@/types';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport async function GET(req: NextRequest) {\n  const { searchParams } = new URL(req.url);\n  const affiliatorId = searchParams.get('affiliatorId');\n\n  if (!affiliatorId) {\n    return NextResponse.json({ error: 'affiliatorId is required' }, { status: 400 });\n  }\n\n  try {\n    const client = await clientPromise;\n    const db = client.db();\n\n    const userLinks = (await db.collection<AffiliateLink>('affiliateLinks').find({ affiliatorId }).toArray()).map(link => ({ ...link, id: link._id.toString() }));\n    const productIds = userLinks.map(link => link.productId);\n    const products = await db.collection<Product>('products').find({ _id: { $in: productIds } }).toArray();\n\n    const linksWithProducts = userLinks.map(link => {\n      const product = products.find(p => p._id.toString() === link.productId);\n      return {\n        ...link,\n        productName: product?.name || 'Unknown Product',\n        productPrice: product?.price || 0,\n        commissionRate: product ? `${product.commissionValue}${product.commissionType === 'percentage' ? '%' : '$'}` : 'N/A',\n      };\n    });\n\n    return NextResponse.json(linksWithProducts);\n  } catch (error) {\n    return NextResponse.json({ error: 'Something went wrong' }, { status: 500 });\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { affiliatorId, productId, code, isActive } = await req.json();\n\n    if (!affiliatorId || !productId || !code) {\n      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });\n    }\n\n    const client = await clientPromise;\n    const db = client.db();\n\n    const newLink = {\n      affiliatorId,\n      productId,\n      code,\n      isActive: isActive ?? true,\n    };\n\n    const result = await db.collection('affiliateLinks').insertOne(newLink);\n\n    // Return the inserted document with _id mapped to id\n    const insertedLink = { ...newLink, id: result.insertedId.toString() };\n\n    return NextResponse.json(insertedLink, { status: 201 });\n  } catch (error) {\n    console.error('Error creating affiliate link:', error);\n    return NextResponse.json({ error: 'Something went wrong' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAIO,eAAe,IAAI,GAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,eAAe,aAAa,GAAG,CAAC;IAEtC,IAAI,CAAC,cAAc;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;IAEA,IAAI;QACF,MAAM,SAAS,MAAM,kIAAa;QAClC,MAAM,KAAK,OAAO,EAAE;QAEpB,MAAM,YAAY,CAAC,MAAM,GAAG,UAAU,CAAgB,kBAAkB,IAAI,CAAC;YAAE;QAAa,GAAG,OAAO,EAAE,EAAE,GAAG,CAAC,CAAA,OAAQ,CAAC;gBAAE,GAAG,IAAI;gBAAE,IAAI,KAAK,GAAG,CAAC,QAAQ;YAAG,CAAC;QAC3J,MAAM,aAAa,UAAU,GAAG,CAAC,CAAA,OAAQ,KAAK,SAAS;QACvD,MAAM,WAAW,MAAM,GAAG,UAAU,CAAU,YAAY,IAAI,CAAC;YAAE,KAAK;gBAAE,KAAK;YAAW;QAAE,GAAG,OAAO;QAEpG,MAAM,oBAAoB,UAAU,GAAG,CAAC,CAAA;YACtC,MAAM,UAAU,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,GAAG,CAAC,QAAQ,OAAO,KAAK,SAAS;YACtE,OAAO;gBACL,GAAG,IAAI;gBACP,aAAa,SAAS,QAAQ;gBAC9B,cAAc,SAAS,SAAS;gBAChC,gBAAgB,UAAU,GAAG,QAAQ,eAAe,GAAG,QAAQ,cAAc,KAAK,eAAe,MAAM,KAAK,GAAG;YACjH;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAElE,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,MAAM;YACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,SAAS,MAAM,kIAAa;QAClC,MAAM,KAAK,OAAO,EAAE;QAEpB,MAAM,UAAU;YACd;YACA;YACA;YACA,UAAU,YAAY;QACxB;QAEA,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,kBAAkB,SAAS,CAAC;QAE/D,qDAAqD;QACrD,MAAM,eAAe;YAAE,GAAG,OAAO;YAAE,IAAI,OAAO,UAAU,CAAC,QAAQ;QAAG;QAEpE,OAAO,gJAAY,CAAC,IAAI,CAAC,cAAc;YAAE,QAAQ;QAAI;IACvD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF"}}]
}
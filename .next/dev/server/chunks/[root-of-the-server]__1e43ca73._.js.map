{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/game/affiliate-growth-hub/src/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from 'mongodb';\n\nconst uri = process.env.MONGODB_URI;\nconst options = {};\n\nif (!uri) {\n  throw new Error('Please add your Mongo URI to .env.local');\n}\n\nlet client: MongoClient;\nlet clientPromise: Promise<MongoClient>;\n\nif (process.env.NODE_ENV === 'development') {\n  // In development mode, use a global variable so that the value\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\n  if (!global._mongoClientPromise) {\n    client = new MongoClient(uri, options);\n    global._mongoClientPromise = client.connect();\n  }\n  clientPromise = global._mongoClientPromise;\n} else {\n  // In production mode, it's best to not use a global variable.\n  client = new MongoClient(uri, options);\n  clientPromise = client.connect();\n}\n\n// Export a module-scoped MongoClient promise. By doing this in a\n// separate module, the client can be shared across functions.\nexport default clientPromise;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI,CAAC,KAAK;IACR,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,yDAAO,mBAAmB,EAAE;QAC/B,SAAS,IAAI,oKAAW,CAAC,KAAK;QAC9B,yDAAO,mBAAmB,GAAG,OAAO,OAAO;IAC7C;IACA,gBAAgB,yDAAO,mBAAmB;AAC5C;;uCAQe"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///D:/game/affiliate-growth-hub/src/services/dataService.ts"],"sourcesContent":["import clientPromise from '@/lib/mongodb';\nimport { Collection, MongoClient } from 'mongodb';\n\ninterface Product {\n  id: string;\n  name: string;\n  slug: string;\n  price: number;\n  description: string;\n  imageUrl: string;\n  commissionType: 'percentage' | 'fixed';\n  commissionValue: number;\n  isActive: boolean;\n}\n\ninterface AffiliateLink {\n  id: string;\n  code: string;\n  productId: string;\n  affiliatorId: string;\n  createdAt: Date;\n}\n\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n  password?: string; // Password might not always be needed or should be handled securely\n  role: 'admin' | 'affiliator';\n  status: 'approved' | 'pending';\n  createdAt: Date;\n}\n\nlet client: MongoClient;\nlet productsCollection: Collection<Product>;\nlet affiliateLinksCollection: Collection<AffiliateLink>;\nlet usersCollection: Collection<User>;\n\nasync function init() {\n  if (client && client.isConnected()) {\n    return;\n  }\n  try {\n    client = await clientPromise;\n    const db = client.db('affiliate_hub'); // Assuming database name is 'affiliate_hub'\n    productsCollection = db.collection<Product>('products');\n    affiliateLinksCollection = db.collection<AffiliateLink>('affiliateLinks');\n    usersCollection = db.collection<User>('users');\n  } catch (error) {\n    console.error('Failed to connect to DB or get collections:', error);\n    throw new Error('Database initialization failed');\n  }\n}\n\nexport async function getProducts(): Promise<Product[]> {\n  await init();\n  return productsCollection.find({}).toArray();\n}\n\nexport async function getProductBySlug(slug: string): Promise<Product | null> {\n  await init();\n  return productsCollection.findOne({ slug });\n}\n\nexport async function getAffiliateLinks(): Promise<AffiliateLink[]> {\n  await init();\n  return affiliateLinksCollection.find({}).toArray();\n}\n\nexport async function getAffiliateLinkByCode(code: string): Promise<AffiliateLink | null> {\n  await init();\n  return affiliateLinksCollection.findOne({ code });\n}\n\nexport async function getUsers(): Promise<User[]> {\n  await init();\n  return usersCollection.find({}).toArray();\n}\n\nexport async function getUserById(id: string): Promise<User | null> {\n  await init();\n  return usersCollection.findOne({ id });\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAiCA,IAAI;AACJ,IAAI;AACJ,IAAI;AACJ,IAAI;AAEJ,eAAe;IACb,IAAI,UAAU,OAAO,WAAW,IAAI;QAClC;IACF;IACA,IAAI;QACF,SAAS,MAAM,kIAAa;QAC5B,MAAM,KAAK,OAAO,EAAE,CAAC,kBAAkB,4CAA4C;QACnF,qBAAqB,GAAG,UAAU,CAAU;QAC5C,2BAA2B,GAAG,UAAU,CAAgB;QACxD,kBAAkB,GAAG,UAAU,CAAO;IACxC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe;IACpB,MAAM;IACN,OAAO,mBAAmB,IAAI,CAAC,CAAC,GAAG,OAAO;AAC5C;AAEO,eAAe,iBAAiB,IAAY;IACjD,MAAM;IACN,OAAO,mBAAmB,OAAO,CAAC;QAAE;IAAK;AAC3C;AAEO,eAAe;IACpB,MAAM;IACN,OAAO,yBAAyB,IAAI,CAAC,CAAC,GAAG,OAAO;AAClD;AAEO,eAAe,uBAAuB,IAAY;IACvD,MAAM;IACN,OAAO,yBAAyB,OAAO,CAAC;QAAE;IAAK;AACjD;AAEO,eAAe;IACpB,MAAM;IACN,OAAO,gBAAgB,IAAI,CAAC,CAAC,GAAG,OAAO;AACzC;AAEO,eAAe,YAAY,EAAU;IAC1C,MAAM;IACN,OAAO,gBAAgB,OAAO,CAAC;QAAE;IAAG;AACtC"}},
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///D:/game/affiliate-growth-hub/src/app/api/checkout/%5BproductSlug%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getProductBySlug, getAffiliateLinkByCode, getUserById } from '@/services/dataService';\n\nexport async function GET(request: NextRequest, context: any) {\n  try {\n    const { productSlug } = context.params;\n    const { searchParams } = new URL(request.url);\n    const refCode = searchParams.get('ref');\n\n    if (!refCode) {\n      return NextResponse.json({ error: 'Referral code is missing' }, { status: 400 });\n    }\n\n    const affiliateLink = await getAffiliateLinkByCode(refCode);\n    if (!affiliateLink) {\n      return NextResponse.json({ error: 'Invalid affiliate link' }, { status: 404 });\n    }\n\n    const product = await getProductBySlug(productSlug);\n    if (!product || product.id !== affiliateLink.productId) {\n      return NextResponse.json({ error: 'Product not found or mismatch' }, { status: 404 });\n    }\n\n    const affiliator = await getUserById(affiliateLink.affiliatorId);\n    if (!affiliator || affiliator.status !== 'approved') {\n      return NextResponse.json({ error: 'Affiliator not found or not approved' }, { status: 404 });\n    }\n\n    return NextResponse.json({ product, affiliateLink, affiliator });\n  } catch (error) {\n    console.error('API Error:', error);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB,EAAE,OAAY;IAC1D,IAAI;QACF,MAAM,EAAE,WAAW,EAAE,GAAG,QAAQ,MAAM;QACtC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,UAAU,aAAa,GAAG,CAAC;QAEjC,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,gBAAgB,MAAM,IAAA,0JAAsB,EAAC;QACnD,IAAI,CAAC,eAAe;YAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,MAAM,UAAU,MAAM,IAAA,oJAAgB,EAAC;QACvC,IAAI,CAAC,WAAW,QAAQ,EAAE,KAAK,cAAc,SAAS,EAAE;YACtD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgC,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,MAAM,aAAa,MAAM,IAAA,+IAAW,EAAC,cAAc,YAAY;QAC/D,IAAI,CAAC,cAAc,WAAW,MAAM,KAAK,YAAY;YACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAS;YAAe;QAAW;IAChE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}